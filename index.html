<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Folheto estilo Atacadista</title>
<style>
  :root{
    --text:#eaf2ff;
    --muted:#b8c7da;
    --panel: rgba(255,255,255,.06);
    --line: rgba(255,255,255,.12);
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: Arial, Helvetica, sans-serif;
    background: linear-gradient(180deg,#061425,#0d3b66);
    color:var(--text);
    padding:18px;
  }
  .wrap{max-width:1100px;margin:0 auto;}
  h1{margin:6px 0 4px;font-size:22px}
  p{margin:0 0 14px;color:var(--muted);font-size:13px;line-height:1.4}
  .grid{display:grid;gap:14px;grid-template-columns:1fr;}
  @media (min-width: 980px){ .grid{grid-template-columns: 430px 1fr;} }

  .panel{
    background: var(--panel);
    border:1px solid var(--line);
    border-radius:16px;
    overflow:hidden;
    box-shadow:0 18px 50px rgba(0,0,0,.35);
  }
  .hd{
    padding:12px 14px;
    background:rgba(0,0,0,.18);
    border-bottom:1px solid rgba(255,255,255,.10);
    display:flex;justify-content:space-between;align-items:center;gap:10px;
  }
  .hd b{font-size:14px}
  .pill{
    font-size:12px;color:#d7e6ff;
    background: rgba(45,103,255,.18);
    border:1px solid rgba(45,103,255,.35);
    padding:6px 10px;border-radius:999px;white-space:nowrap
  }
  .bd{padding:12px 14px;background:rgba(10,24,40,.25)}
  label{display:block;font-size:12px;color:var(--muted);margin:10px 0 6px}
  input, select{
    width:100%;
    padding:11px 12px;
    border-radius:12px;
    border:1px solid rgba(255,255,255,.14);
    background:rgba(255,255,255,.06);
    color:var(--text);
    outline:none;
  }
  input::placeholder{color:rgba(234,242,255,.55)}
  .row{display:grid;gap:10px}
  .row.two{grid-template-columns:1fr 1fr}
  @media(max-width:460px){.row.two{grid-template-columns:1fr}}

  .btn{
    width:100%;border:0;border-radius:12px;padding:12px 14px;
    font-weight:700;cursor:pointer;color:white;margin-top:12px;
  }
  .btn.ok{background:linear-gradient(180deg,#12c06b,#00a650)}
  .btn.blue{background:linear-gradient(180deg,#2d67ff,#1b4dff);display:none}
  .small{font-size:12px;color:var(--muted);margin-top:10px;line-height:1.4}

  .prodItem{
    background:rgba(0,0,0,.18);
    border:1px solid rgba(255,255,255,.10);
    border-radius:14px;
    padding:10px;
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:8px;
    margin-top:10px;
  }
  .prodItem .full{grid-column:1/-1}
  .prodItem button{
    grid-column:1/-1;
    background:#ff3b30;color:white;border:0;border-radius:10px;
    padding:10px;font-weight:700;cursor:pointer;
  }

  .previewBox{padding:14px;background:rgba(0,0,0,.12)}
  #out{
    width:100%;
    border-radius:16px;
    border:1px solid rgba(255,255,255,.12);
    display:none;
    box-shadow:0 20px 60px rgba(0,0,0,.35);
  }
  .empty{
    text-align:center;
    padding:30px 12px;
    color:rgba(234,242,255,.75);
    border:1px dashed rgba(255,255,255,.16);
    border-radius:16px;
  }
  canvas{display:none}
</style>
</head>
<body>
<div class="wrap">
  <h1>Folheto estilo Assaí (clean)</h1>
  <p>Topo azul + fundo branco + preços vermelhos + grade de produtos, bem organizado.</p>

  <div class="grid">
    <div class="panel">
      <div class="hd">
        <b>Configuração</b>
        <span class="pill">Estilo Atacadista</span>
      </div>
      <div class="bd">
        <div class="row two">
          <div>
            <label>Logo esquerda (opcional)</label>
            <input type="file" id="logoL" accept="image/*" />
          </div>
          <div>
            <label>Logo direita (opcional)</label>
            <input type="file" id="logoR" accept="image/*" />
          </div>
        </div>

        <label>Título do topo</label>
        <input id="titulo" value="LEVE PREÇO BAIXO E QUALIDADE" />

        <div class="row two">
          <div>
            <label>Subtítulo</label>
            <input id="sub" value="LEVE O MERCADO COM VOCÊ" />
          </div>
          <div>
            <label>Validade (texto)</label>
            <input id="validade" value="Válido até 14/02" />
          </div>
        </div>

        <div class="row two">
          <div>
            <label>Nome da loja (rodapé)</label>
            <input id="loja" placeholder="Ex: Mercantil do João" />
          </div>
          <div>
            <label>WhatsApp (rodapé)</label>
            <input id="whats" placeholder="Ex: (88) 9 9999-9999" />
          </div>
        </div>

        <div class="row two">
          <div>
            <label>Formato</label>
            <select id="formato">
              <option value="1350">Feed (1080×1350)</option>
              <option value="1920">Status (1080×1920)</option>
            </select>
          </div>
          <div>
            <label>Colunas</label>
            <select id="cols">
              <option value="3">3 colunas (igual folheto)</option>
              <option value="4">4 colunas (mais produtos)</option>
            </select>
          </div>
        </div>

        <label>Adicionar produto</label>
        <div class="prodItem">
          <div class="full"><input type="file" id="pFoto" accept="image/*" /></div>
          <input id="pNome" placeholder="Nome do produto" />
          <input id="pDesc" placeholder="Descrição curta (ex: 500ml / 1kg)" />
          <input id="pPreco" placeholder="Preço (ex: 10,90)" />
          <input id="pObs" class="full" placeholder="Obs pequena (ex: CADA / UND / kg)" />
          <button type="button" onclick="addProduto()">+ Adicionar na lista</button>
        </div>

        <div id="lista"></div>

        <button class="btn ok" onclick="gerar()">Gerar folheto</button>
        <button class="btn blue" id="baixarBtn" onclick="baixar()">Baixar PNG</button>

        <div class="small">Dica: use 9–12 produtos para ficar com cara de folheto. Preço sempre com vírgula.</div>
      </div>
    </div>

    <div class="panel">
      <div class="hd">
        <b>Pré-visualização</b>
        <span class="pill">Pronto pra postar</span>
      </div>
      <div class="previewBox">
        <div class="empty" id="empty">Gere o folheto para ver a imagem aqui.</div>
        <img id="out" alt="Folheto pronto" />
      </div>
    </div>
  </div>

  <canvas id="c"></canvas>
</div>

<script>
  function roundRect(ctx, x, y, w, h, r){
    const min = Math.min(w,h);
    r = Math.min(r, min/2);
    ctx.beginPath();
    ctx.moveTo(x+r, y);
    ctx.arcTo(x+w, y, x+w, y+h, r);
    ctx.arcTo(x+w, y+h, x, y+h, r);
    ctx.arcTo(x, y+h, x, y, r);
    ctx.arcTo(x, y, x+w, y, r);
    ctx.closePath();
  }

  function drawImageContain(ctx, img, x, y, w, h){
    const iw=img.width, ih=img.height;
    const s=Math.min(w/iw, h/ih);
    const nw=iw*s, nh=ih*s;
    const nx=x+(w-nw)/2, ny=y+(h-nh)/2;
    ctx.drawImage(img,nx,ny,nw,nh);
  }

  function loadFileAsImage(file){
    return new Promise((resolve,reject)=>{
      if(!file) return resolve(null);
      const r=new FileReader();
      r.onload=(e)=>{
        const img=new Image();
        img.onload=()=>resolve(img);
        img.onerror=reject;
        img.src=e.target.result;
      };
      r.onerror=reject;
      r.readAsDataURL(file);
    });
  }

  function wrapText(ctx, text, x, y, maxWidth, lineHeight, maxLines, align="left"){
    text = (text || "").trim();
    if(!text) return y;
    const words = text.split(/\s+/);
    let line = "";
    let lines = 0;

    const old = ctx.textAlign;
    ctx.textAlign = align;

    for(let n=0;n<words.length;n++){
      const test = line + words[n] + " ";
      if(ctx.measureText(test).width > maxWidth && n>0){
        ctx.fillText(line.trim(), x, y);
        line = words[n] + " ";
        y += lineHeight;
        lines++;
        if(maxLines && lines >= maxLines){
          ctx.textAlign = old;
          return y;
        }
      } else line = test;
    }
    if(!maxLines || lines < maxLines) ctx.fillText(line.trim(), x, y);
    ctx.textAlign = old;
    return y + lineHeight;
  }

  const produtos = [];
  let lastDataUrl = "";

  function renderLista(){
    const el = document.getElementById("lista");
    el.innerHTML = "";
    produtos.forEach((p,i)=>{
      const d = document.createElement("div");
      d.className = "prodItem";
      d.innerHTML = `
        <div class="full" style="color:#d7e6ff;font-weight:700">#${i+1} • ${p.nome} (R$ ${p.preco})</div>
        <div>Desc: <b>${p.desc || "-"}</b></div>
        <div>Obs: <b>${p.obs || "-"}</b></div>
        <button type="button" onclick="remover(${i})">Remover</button>
      `;
      el.appendChild(d);
    });
  }

  async function addProduto(){
    const file = document.getElementById("pFoto").files[0];
    const nome = (document.getElementById("pNome").value||"").trim();
    const desc = (document.getElementById("pDesc").value||"").trim();
    const preco = (document.getElementById("pPreco").value||"").trim();
    const obs  = (document.getElementById("pObs").value||"").trim();
    if(!file || !nome || !preco){
      alert("Para adicionar: Foto + Nome + Preço (obrigatório).");
      return;
    }
    const img = await loadFileAsImage(file);
    produtos.push({img, nome, desc, preco, obs});
    document.getElementById("pFoto").value="";
    document.getElementById("pNome").value="";
    document.getElementById("pDesc").value="";
    document.getElementById("pPreco").value="";
    document.getElementById("pObs").value="";
    renderLista();
  }

  function remover(i){
    produtos.splice(i,1);
    renderLista();
  }

  async function gerar(){
    if(produtos.length === 0){
      alert("Adicione pelo menos 1 produto.");
      return;
    }

    const formato = document.getElementById("formato").value;
    const cols = parseInt(document.getElementById("cols").value,10);

    const titulo = (document.getElementById("titulo").value||"").trim();
    const sub = (document.getElementById("sub").value||"").trim();
    const validade = (document.getElementById("validade").value||"").trim();
    const loja = (document.getElementById("loja").value||"").trim();
    const whats = (document.getElementById("whats").value||"").trim();

    const logoL = await loadFileAsImage(document.getElementById("logoL").files[0]);
    const logoR = await loadFileAsImage(document.getElementById("logoR").files[0]);

    const canvas = document.getElementById("c");
    const ctx = canvas.getContext("2d");

    const W = 1080;
    const H = (formato === "1920") ? 1920 : 1350;
    canvas.width = W; canvas.height = H;

    // ===== Fundo branco (folheto) =====
    ctx.fillStyle = "#ffffff";
    ctx.fillRect(0,0,W,H);

    // ===== Header azul =====
    ctx.fillStyle = "#1b4dff";
    ctx.fillRect(0,0,W,220);

    // linha arco/cores
    ctx.fillStyle = "#ffd400";
    ctx.fillRect(0,220,W,10);
    ctx.fillStyle = "#ff3b30";
    ctx.fillRect(0,230,W,8);

    // textos topo
    ctx.fillStyle = "#fff";
    ctx.font = "900 58px Arial";
    wrapText(ctx, titulo.toUpperCase(), 540, 85, 780, 58, 2, "center");

    ctx.font = "700 30px Arial";
    wrapText(ctx, sub.toUpperCase(), 540, 175, 780, 34, 1, "center");

    // validade (canto)
    ctx.fillStyle = "rgba(0,0,0,.55)";
    roundRect(ctx, 820, 18, 240, 52, 18);
    ctx.fill();
    ctx.fillStyle = "#fff";
    ctx.font = "700 24px Arial";
    ctx.fillText(validade, 840, 52);

    // logos
    if(logoL){
      ctx.fillStyle = "rgba(255,255,255,.92)";
      roundRect(ctx, 30, 35, 150, 150, 22);
      ctx.fill();
      drawImageContain(ctx, logoL, 30, 35, 150, 150);
    }
    if(logoR){
      ctx.fillStyle = "rgba(255,255,255,.92)";
      roundRect(ctx, 900, 80, 150, 100, 22);
      ctx.fill();
      drawImageContain(ctx, logoR, 900, 80, 150, 100);
    }

    // ===== Grade =====
    const topY = 260;
    const bottomY = H - 130;
    const areaH = bottomY - topY;

    const padX = 40;
    const gapX = 22;
    const gapY = 22;

    const cardW = (W - padX*2 - gapX*(cols-1)) / cols;
    const rows = Math.ceil(produtos.length / cols);
    const cardH = Math.min(320, (areaH - gapY*(rows-1)) / rows);

    let idx = 0;
    for(let r=0; r<rows; r++){
      for(let c=0; c<cols; c++){
        if(idx >= produtos.length) break;
        const p = produtos[idx++];

        const x = padX + c*(cardW + gapX);
        const y = topY + r*(cardH + gapY);

        // card (limpo)
        ctx.fillStyle = "#ffffff";
        ctx.strokeStyle = "rgba(0,0,0,.15)";
        ctx.lineWidth = 2;
        roundRect(ctx, x, y, cardW, cardH, 16);
        ctx.fill();
        ctx.stroke();

        // foto (contain)
        const imgX = x + 10;
        const imgY = y + 10;
        const imgW = cardW - 20;
        const imgH = cardH * 0.55;
        ctx.fillStyle = "#f5f5f5";
        roundRect(ctx, imgX, imgY, imgW, imgH, 12);
        ctx.fill();
        drawImageContain(ctx, p.img, imgX, imgY, imgW, imgH);

        // textos
        ctx.fillStyle = "#111";
        ctx.font = "900 22px Arial";
        wrapText(ctx, p.nome.toUpperCase(), x + cardW/2, y + imgH + 52, cardW-18, 24, 2, "center");

        ctx.fillStyle = "#333";
        ctx.font = "700 18px Arial";
        wrapText(ctx, p.desc, x + cardW/2, y + imgH + 102, cardW-18, 20, 1, "center");

        // preço vermelho grande
        ctx.fillStyle = "#d10000";
        ctx.font = "900 40px Arial";
        ctx.textAlign = "center";
        ctx.fillText("R$ " + p.preco, x + cardW/2, y + cardH - 26);
        ctx.textAlign = "left";

        // obs pequena
        ctx.fillStyle = "#444";
        ctx.font = "700 16px Arial";
        wrapText(ctx, (p.obs || "").toUpperCase(), x + cardW/2, y + cardH - 6, cardW-18, 18, 1, "center");
      }
    }

    // ===== Rodapé =====
    ctx.fillStyle = "#f2f2f2";
    ctx.fillRect(0, H-85, W, 85);

    ctx.fillStyle = "#111";
    ctx.font = "700 18px Arial";
    const footer = [loja, whats].filter(Boolean).join(" • ");
    ctx.fillText(footer || "Ofertas válidas enquanto durarem os estoques. Imagens ilustrativas.", 40, H-35);

    lastDataUrl = canvas.toDataURL("image/png");
    const out = document.getElementById("out");
    out.src = lastDataUrl;
    out.style.display = "block";
    document.getElementById("empty").style.display = "none";
    document.getElementById("baixarBtn").style.display = "block";
  }

  function baixar(){
    if(!lastDataUrl) return;
    const a = document.createElement("a");
    a.href = lastDataUrl;
    a.download = "folheto-atacadista.png";
    document.body.appendChild(a);
    a.click();
    a.remove();
  }
</script>
</body>
</html>
