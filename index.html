<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Flyer Supermercado (WhatsApp)</title>
<style>
  :root{
    --text:#eaf2ff;
    --muted:#b8c7da;
    --panel: rgba(255,255,255,.06);
    --line: rgba(255,255,255,.12);
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: Arial, Helvetica, sans-serif;
    background: linear-gradient(180deg,#061425,#0d3b66);
    color:var(--text);
    padding:18px;
  }
  .wrap{max-width:1100px;margin:0 auto;}
  h1{margin:6px 0 4px;font-size:22px}
  p{margin:0 0 14px;color:var(--muted);font-size:13px;line-height:1.4}
  .grid{display:grid;gap:14px;grid-template-columns:1fr;}
  @media (min-width: 980px){ .grid{grid-template-columns: 430px 1fr;} }

  .panel{
    background: var(--panel);
    border:1px solid var(--line);
    border-radius:16px;
    overflow:hidden;
    box-shadow:0 18px 50px rgba(0,0,0,.35);
  }
  .hd{
    padding:12px 14px;
    background:rgba(0,0,0,.18);
    border-bottom:1px solid rgba(255,255,255,.10);
    display:flex;justify-content:space-between;align-items:center;gap:10px;
  }
  .hd b{font-size:14px}
  .pill{
    font-size:12px;color:#d7e6ff;
    background: rgba(255,212,0,.18);
    border:1px solid rgba(255,212,0,.35);
    padding:6px 10px;border-radius:999px;white-space:nowrap
  }
  .bd{padding:12px 14px;background:rgba(10,24,40,.25)}
  label{display:block;font-size:12px;color:var(--muted);margin:10px 0 6px}
  input{
    width:100%;
    padding:11px 12px;
    border-radius:12px;
    border:1px solid rgba(255,255,255,.14);
    background:rgba(255,255,255,.06);
    color:var(--text);
    outline:none;
  }
  input::placeholder{color:rgba(234,242,255,.55)}
  .row{display:grid;gap:10px}
  .row.two{grid-template-columns:1fr 1fr}
  @media(max-width:460px){.row.two{grid-template-columns:1fr}}

  .btn{
    width:100%;border:0;border-radius:12px;padding:12px 14px;
    font-weight:700;cursor:pointer;color:white;margin-top:12px;
  }
  .btn.ok{background:linear-gradient(180deg,#12c06b,#00a650)}
  .btn.blue{background:linear-gradient(180deg,#2d67ff,#1b4dff);display:none}
  .small{font-size:12px;color:var(--muted);margin-top:10px;line-height:1.4}

  .prodItem{
    background:rgba(0,0,0,.18);
    border:1px solid rgba(255,255,255,.10);
    border-radius:14px;
    padding:10px;
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:8px;
    margin-top:10px;
  }
  .prodItem .full{grid-column:1/-1}
  .prodItem button{
    grid-column:1/-1;
    background:#ff3b30;color:white;border:0;border-radius:10px;
    padding:10px;font-weight:700;cursor:pointer;
  }

  .previewBox{padding:14px;background:rgba(0,0,0,.12)}
  #out{
    width:100%;
    border-radius:16px;
    border:1px solid rgba(255,255,255,.12);
    display:none;
    box-shadow:0 20px 60px rgba(0,0,0,.35);
  }
  .empty{
    text-align:center;
    padding:30px 12px;
    color:rgba(234,242,255,.75);
    border:1px dashed rgba(255,255,255,.16);
    border-radius:16px;
  }
  canvas{display:none}
</style>
</head>
<body>
<div class="wrap">
  <h1>Flyer estilo supermercado (Status 1080×1920)</h1>
  <p>Corrigido: logo não cobre título, nomes centralizados e foto não esconde descrição.</p>

  <div class="grid">
    <div class="panel">
      <div class="hd">
        <b>Montar flyer</b>
        <span class="pill">2 colunas • organizado</span>
      </div>
      <div class="bd">
        <label>Logo (opcional)</label>
        <input type="file" id="logo" accept="image/*" />

        <label>Título</label>
        <input id="titulo" value="SUPER OFERTAS" />

        <label>Subtítulo</label>
        <input id="subtitulo" value="FINAL DE SEMANA" />

        <div class="row two">
          <div>
            <label>Nome da loja</label>
            <input id="loja" placeholder="Ex: Mercantil do João" />
          </div>
          <div>
            <label>WhatsApp</label>
            <input id="whats" placeholder="Ex: (88) 9 9999-9999" />
          </div>
        </div>

        <label>Adicionar produto</label>
        <div class="prodItem">
          <div class="full"><input type="file" id="pFoto" accept="image/*" /></div>
          <input id="pNome" placeholder="Nome do produto" />
          <input id="pUn" placeholder="Unidade (ex: 1kg / 1L / und)" />
          <input id="pPreco" placeholder="Preço (ex: 9,99)" />
          <input id="pObs" class="full" placeholder="Obs (opcional: -1kg, por cliente…)" />
          <button type="button" onclick="addProduto()">+ Adicionar na lista</button>
        </div>

        <div id="lista"></div>

        <button class="btn ok" onclick="gerarFlyer()">Gerar flyer</button>
        <button class="btn blue" id="baixarBtn" onclick="baixar()">Baixar PNG</button>

        <div class="small">Dica: 2 a 8 produtos fica perfeito. Fotos muito verticais ainda ficam ok (a gente corta no “cover”).</div>
      </div>
    </div>

    <div class="panel">
      <div class="hd">
        <b>Pré-visualização</b>
        <span class="pill">Pronta pra postar</span>
      </div>
      <div class="previewBox">
        <div class="empty" id="empty">Gere o flyer para ver a imagem aqui.</div>
        <img id="out" alt="Flyer pronto" />
      </div>
    </div>
  </div>

  <canvas id="c"></canvas>
</div>

<script>
  // ===== util desenho =====
  function roundRect(ctx, x, y, w, h, r){
    const min = Math.min(w,h);
    r = Math.min(r, min/2);
    ctx.beginPath();
    ctx.moveTo(x+r, y);
    ctx.arcTo(x+w, y, x+w, y+h, r);
    ctx.arcTo(x+w, y+h, x, y+h, r);
    ctx.arcTo(x, y+h, x, y, r);
    ctx.arcTo(x, y, x+w, y, r);
    ctx.closePath();
  }

  function drawImageCover(ctx, img, x, y, w, h, r){
    const iw=img.width, ih=img.height;
    const ir=iw/ih, rr=w/h;
    let sx,sy,sw,sh;
    if(ir>rr){ sh=ih; sw=ih*rr; sx=(iw-sw)/2; sy=0; }
    else { sw=iw; sh=iw/rr; sx=0; sy=(ih-sh)/2; }
    ctx.save();
    roundRect(ctx,x,y,w,h,r);
    ctx.clip();
    ctx.drawImage(img,sx,sy,sw,sh,x,y,w,h);
    ctx.restore();
  }

  function drawLogoContain(ctx, img, x, y, w, h, r){
    const iw=img.width, ih=img.height;
    const s=Math.min(w/iw, h/ih);
    const nw=iw*s, nh=ih*s;
    const nx=x+(w-nw)/2, ny=y+(h-nh)/2;
    ctx.save();
    roundRect(ctx,x,y,w,h,r);
    ctx.clip();
    ctx.drawImage(img,nx,ny,nw,nh);
    ctx.restore();
  }

  function loadFileAsImage(file){
    return new Promise((resolve,reject)=>{
      if(!file) return resolve(null);
      const r=new FileReader();
      r.onload=(e)=>{
        const img=new Image();
        img.onload=()=>resolve(img);
        img.onerror=reject;
        img.src=e.target.result;
      };
      r.onerror=reject;
      r.readAsDataURL(file);
    });
  }

  // quebra texto em linhas e centraliza opcionalmente
  function wrapText(ctx, text, x, y, maxWidth, lineHeight, maxLines, align="left"){
    text = (text || "").trim();
    if(!text) return y;
    const words = text.split(/\s+/);
    let line = "";
    let lines = 0;

    const oldAlign = ctx.textAlign;
    ctx.textAlign = align;

    for(let n=0; n<words.length; n++){
      const test = line + words[n] + " ";
      if(ctx.measureText(test).width > maxWidth && n>0){
        ctx.fillText(line.trim(), x, y);
        line = words[n] + " ";
        y += lineHeight;
        lines++;
        if(maxLines && lines >= maxLines){
          ctx.textAlign = oldAlign;
          return y;
        }
      } else {
        line = test;
      }
    }
    if(!maxLines || lines < maxLines) ctx.fillText(line.trim(), x, y);
    ctx.textAlign = oldAlign;
    return y + lineHeight;
  }

  // “estrelinha” simples na etiqueta
  function drawStar(ctx, cx, cy, spikes, outerR, innerR){
    let rot = Math.PI / 2 * 3;
    let x = cx, y = cy;
    const step = Math.PI / spikes;

    ctx.beginPath();
    ctx.moveTo(cx, cy - outerR);
    for (let i=0;i<spikes;i++){
      x = cx + Math.cos(rot) * outerR;
      y = cy + Math.sin(rot) * outerR;
      ctx.lineTo(x,y);
      rot += step;

      x = cx + Math.cos(rot) * innerR;
      y = cy + Math.sin(rot) * innerR;
      ctx.lineTo(x,y);
      rot += step;
    }
    ctx.lineTo(cx, cy - outerR);
    ctx.closePath();
  }

  // ===== estado =====
  const produtos = [];
  let lastDataUrl = "";

  function renderLista(){
    const el = document.getElementById("lista");
    el.innerHTML = "";
    produtos.forEach((p, i)=>{
      const d = document.createElement("div");
      d.className = "prodItem";
      d.innerHTML = `
        <div class="full" style="color:#d7e6ff;font-weight:700">#${i+1} • ${p.nome} (R$ ${p.preco})</div>
        <div>Unidade: <b>${p.unidade || "-"}</b></div>
        <div>Obs: <b>${p.obs || "-"}</b></div>
        <button type="button" onclick="remover(${i})">Remover</button>
      `;
      el.appendChild(d);
    });
  }

  async function addProduto(){
    const file = document.getElementById("pFoto").files[0];
    const nome = (document.getElementById("pNome").value || "").trim();
    const unidade = (document.getElementById("pUn").value || "").trim();
    const preco = (document.getElementById("pPreco").value || "").trim();
    const obs = (document.getElementById("pObs").value || "").trim();

    if(!file || !nome || !preco){
      alert("Para adicionar: Foto + Nome + Preço (obrigatório).");
      return;
    }
    const img = await loadFileAsImage(file);
    produtos.push({img, nome, unidade, preco, obs});

    document.getElementById("pFoto").value="";
    document.getElementById("pNome").value="";
    document.getElementById("pUn").value="";
    document.getElementById("pPreco").value="";
    document.getElementById("pObs").value="";
    renderLista();
  }

  function remover(i){
    produtos.splice(i,1);
    renderLista();
  }

  async function gerarFlyer(){
    if(produtos.length === 0){
      alert("Adicione pelo menos 1 produto.");
      return;
    }

    const titulo = (document.getElementById("titulo").value || "SUPER OFERTAS").trim();
    const subtitulo = (document.getElementById("subtitulo").value || "FINAL DE SEMANA").trim();
    const loja = (document.getElementById("loja").value || "").trim();
    const whats = (document.getElementById("whats").value || "").trim();

    const logoFile = document.getElementById("logo").files[0];
    const logoImg = await loadFileAsImage(logoFile);

    const canvas = document.getElementById("c");
    const ctx = canvas.getContext("2d");

    const W = 1080, H = 1920;
    canvas.width = W; canvas.height = H;

    // ===== FUNDO amarelo/verde =====
    ctx.fillStyle = "#0a7b3a";
    ctx.fillRect(0,0,W,H);

    const g1 = ctx.createRadialGradient(260,260,20, 260,260,720);
    g1.addColorStop(0,"#ffe15a");
    g1.addColorStop(1,"rgba(255,225,90,0)");
    ctx.fillStyle = g1; ctx.fillRect(0,0,W,H);

    const g2 = ctx.createRadialGradient(860,540,20, 860,540,820);
    g2.addColorStop(0,"#9bff67");
    g2.addColorStop(1,"rgba(155,255,103,0)");
    ctx.fillStyle = g2; ctx.fillRect(0,0,W,H);

    // bolhas decor
    for(let i=0;i<18;i++){
      const x = Math.random()*W;
      const y = Math.random()*H;
      const r = 18 + Math.random()*50;
      ctx.beginPath();
      ctx.fillStyle = "rgba(255,255,255,.10)";
      ctx.arc(x,y,r,0,Math.PI*2);
      ctx.fill();
    }

    // ===== HEADER (reservando espaço pro logo) =====
    const headerX = 70, headerY = 80, headerW = W-140, headerH = 230;
    ctx.fillStyle = "#e11b22";
    roundRect(ctx, headerX, headerY, headerW, headerH, 55);
    ctx.fill();

    // brilho
    ctx.fillStyle = "rgba(255,255,255,.18)";
    roundRect(ctx, headerX+18, headerY+18, headerW-36, 86, 45);
    ctx.fill();

    // área do logo (fixa) no header
    const logoBox = (logoImg) ? { w:160, h:160, x: headerX + headerW - 190, y: headerY + 35 } : null;

    if(logoBox){
      ctx.fillStyle = "rgba(255,255,255,.92)";
      roundRect(ctx, logoBox.x, logoBox.y, logoBox.w, logoBox.h, 34);
      ctx.fill();
      drawLogoContain(ctx, logoImg, logoBox.x, logoBox.y, logoBox.w, logoBox.h, 34);
    }

    // texto centralizado, mas sem “invadir” a área do logo
    const textLeft = headerX + 30;
    const textRight = logoBox ? (logoBox.x - 20) : (headerX + headerW - 30);
    const textCenterX = (textLeft + textRight) / 2;
    const textMaxW = (textRight - textLeft);

    ctx.fillStyle = "#fff";
    ctx.textAlign = "center";

    ctx.font = "900 96px Arial";
    // corta se muito grande
    wrapText(ctx, titulo.toUpperCase(), textCenterX, headerY + 130, textMaxW, 92, 1, "center");

    ctx.font = "800 56px Arial";
    wrapText(ctx, subtitulo.toUpperCase(), textCenterX, headerY + 200, textMaxW, 56, 1, "center");

    ctx.textAlign = "left";

    // ===== GRID 2 colunas =====
    const cols = 2;
    const gap = 30;

    const topY = 360;
    const bottomY = H - 170;
    const areaH = bottomY - topY;

    const cardW = (W - 80*2 - gap) / cols;
    const rows = Math.ceil(produtos.length / cols);

    // cardH: ajusta pra não ficar gigante e nem esmagado
    let cardH = (areaH - gap*(rows-1)) / rows;
    cardH = Math.max(300, Math.min(340, cardH)); // limite bom pro texto aparecer

    // centraliza se só 1
    const startX = (produtos.length === 1) ? (W - cardW)/2 : 80;

    let idx = 0;
    for(let r=0; r<rows; r++){
      for(let c=0; c<cols; c++){
        if(idx >= produtos.length) break;
        const p = produtos[idx++];

        const x = startX + c*(cardW + gap);
        const y = topY + r*(cardH + gap);

        // card com sombra
        ctx.save();
        ctx.shadowColor = "rgba(0,0,0,.22)";
        ctx.shadowBlur = 16;
        ctx.shadowOffsetY = 10;
        ctx.fillStyle = "rgba(255,255,255,.96)";
        roundRect(ctx, x, y, cardW, cardH, 32);
        ctx.fill();
        ctx.restore();

        // FOTO MENOR pra não matar texto
        const imgX = x + 18;
        const imgY = y + 18;
        const imgW = cardW - 36;
        const imgH = 170; // fixo, menor (resolve seu problema)
        ctx.fillStyle = "#f4f6fb";
        roundRect(ctx, imgX, imgY, imgW, imgH, 22);
        ctx.fill();
        drawImageCover(ctx, p.img, imgX, imgY, imgW, imgH, 22);

        // textos (centralizados)
        const textX = x + cardW/2;

        ctx.fillStyle = "#111";
        ctx.font = "900 34px Arial";
        // nome 2 linhas central
        let ty = imgY + imgH + 52;
        ctx.textAlign = "center";
        ty = wrapText(ctx, p.nome, textX, ty, imgW, 36, 2, "center");

        // unidade/obs (1 linha)
        ctx.fillStyle = "#333";
        ctx.font = "28px Arial";
        const meta = [p.unidade, p.obs].filter(Boolean).join(" • ");
        wrapText(ctx, meta, textX, ty + 6, imgW, 30, 1, "center");

        ctx.textAlign = "left";

        // etiqueta preço
        const tagW = cardW - 44;
        const tagH = 74;
        const tagX = x + 22;
        const tagY = y + cardH - 92;

        ctx.fillStyle = "#ffffff";
        roundRect(ctx, tagX, tagY, tagW, tagH, 26);
        ctx.fill();

        ctx.lineWidth = 8;
        ctx.strokeStyle = "#e11b22";
        roundRect(ctx, tagX, tagY, tagW, tagH, 26);
        ctx.stroke();

        // estrela
        ctx.fillStyle = "#ffd400";
        drawStar(ctx, tagX + 34, tagY + 38, 5, 17, 8);
        ctx.fill();

        // preço
        ctx.fillStyle = "#e11b22";
        ctx.font = "900 44px Arial";
        ctx.fillText("R$ " + p.preco, tagX + 70, tagY + 52);
      }
    }

    // ===== Rodapé =====
    ctx.fillStyle = "rgba(0,0,0,.20)";
    roundRect(ctx, 70, H-120, W-140, 75, 28);
    ctx.fill();

    ctx.fillStyle = "rgba(255,255,255,.85)";
    ctx.beginPath(); ctx.arc(110, H-82, 10, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(140, H-82, 10, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(170, H-82, 10, 0, Math.PI*2); ctx.fill();

    ctx.fillStyle = "#fff";
    ctx.font = "800 34px Arial";
    const footer = [loja, whats].filter(Boolean).join(" • ");
    ctx.fillText(footer || "Aproveite! Ofertas por tempo limitado.", 200, H-70);

    // Output
    lastDataUrl = canvas.toDataURL("image/png");
    const out = document.getElementById("out");
    out.src = lastDataUrl;
    out.style.display = "block";
    document.getElementById("empty").style.display = "none";
    document.getElementById("baixarBtn").style.display = "block";
  }

  function baixar(){
    if(!lastDataUrl) return;
    const a = document.createElement("a");
    a.href = lastDataUrl;
    a.download = "flyer-super-ofertas.png";
    document.body.appendChild(a);
    a.click();
    a.remove();
  }
</script>
</body>
</html>
