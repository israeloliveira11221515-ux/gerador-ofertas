<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Gerar Arte</title>
<style>
  body { font-family: Arial, sans-serif; background:#0e2235; color:white; text-align:center; margin:0; padding:24px; }
  h1 { margin: 10px 0 18px; }
  .card { background:white; color:black; padding:18px; margin:0 auto; width:min(380px, 92vw); border-radius:16px; }
  input { width:100%; margin:7px 0; padding:12px; border:1px solid #ddd; border-radius:10px; box-sizing:border-box; }
  button { background:#00a650; color:white; padding:14px; border:none; width:100%; font-size:18px; cursor:pointer; border-radius:12px; }
  button:hover { filter: brightness(0.95); }
  .row { display:flex; gap:10px; }
  .row input { width: 50%; }
  canvas { display:none; }
  #resultado { width:min(360px, 92vw); margin-top:18px; border-radius:14px; box-shadow:0 10px 30px rgba(0,0,0,.25); }
  .btn2 { margin:10px auto 0; width:min(380px, 92vw); display:none; background:#1B4DFF; }
</style>
</head>
<body>

<h1>Gerar arte do produto</h1>

<div class="card">
  <input type="file" id="foto" accept="image/*" />
  <input type="text" id="nome" placeholder="Nome do produto" />
  <div class="row">
    <input type="text" id="gramas" placeholder="Gramas ex: 500g" />
    <input type="text" id="preco" placeholder="Preço ex: 12,99" />
  </div>
  <input type="text" id="descricao" placeholder="Descrição (curta)" />
  <button onclick="gerar()">Gerar imagem</button>
</div>

<canvas id="c" width="1080" height="1080"></canvas>
<img id="resultado" alt="Arte pronta" />
<button class="btn2" id="baixarBtn" onclick="baixar()">Baixar imagem (PNG)</button>

<script>
function roundRect(ctx, x, y, w, h, r){
  const min = Math.min(w, h);
  if (r > min/2) r = min/2;
  ctx.beginPath();
  ctx.moveTo(x+r, y);
  ctx.arcTo(x+w, y, x+w, y+h, r);
  ctx.arcTo(x+w, y+h, x, y+h, r);
  ctx.arcTo(x, y+h, x, y, r);
  ctx.arcTo(x, y, x+w, y, r);
  ctx.closePath();
}

function wrapText(ctx, text, x, y, maxWidth, lineHeight, maxLines){
  text = (text || "").trim();
  if (!text) return y;
  const words = text.split(/\s+/);
  let line = "";
  let lines = 0;

  for (let n = 0; n < words.length; n++){
    const test = line + words[n] + " ";
    if (ctx.measureText(test).width > maxWidth && n > 0){
      ctx.fillText(line.trim(), x, y);
      line = words[n] + " ";
      y += lineHeight;
      lines++;
      if (maxLines && lines >= maxLines) return y;
    } else {
      line = test;
    }
  }
  if (!maxLines || lines < maxLines) ctx.fillText(line.trim(), x, y);
  return y + lineHeight;
}

function drawImageCover(ctx, img, x, y, w, h, r){
  const iw = img.width, ih = img.height;
  const ir = iw / ih;
  const rr = w / h;

  let sx, sy, sw, sh;
  if (ir > rr){
    sh = ih;
    sw = ih * rr;
    sx = (iw - sw) / 2;
    sy = 0;
  } else {
    sw = iw;
    sh = iw / rr;
    sx = 0;
    sy = (ih - sh) / 2;
  }

  ctx.save();
  roundRect(ctx, x, y, w, h, r);
  ctx.clip();
  ctx.drawImage(img, sx, sy, sw, sh, x, y, w, h);
  ctx.restore();
}

let lastDataUrl = "";

function gerar(){
  const nome = document.getElementById("nome").value || "Produto";
  const gramas = document.getElementById("gramas").value || "";
  const descricao = document.getElementById("descricao").value || "";
  const preco = document.getElementById("preco").value || "";
  const file = document.getElementById("foto").files[0];

  if (!file){
    alert("Escolha uma foto do produto.");
    return;
  }

  const canvas = document.getElementById("c");
  const ctx = canvas.getContext("2d");
  const W = 1080, H = 1080;

  const reader = new FileReader();
  reader.onload = function(e){
    const img = new Image();
    img.onload = function(){

      // Fundo degradê
      const g = ctx.createLinearGradient(0,0,W,H);
      g.addColorStop(0, "#0b1b2b");
      g.addColorStop(1, "#123a5a");
      ctx.fillStyle = g;
      ctx.fillRect(0,0,W,H);

      // Card branco
      ctx.shadowColor = "rgba(0,0,0,.25)";
      ctx.shadowBlur = 30;
      ctx.shadowOffsetY = 10;
      ctx.fillStyle = "#ffffff";
      roundRect(ctx, 60, 60, 960, 960, 46);
      ctx.fill();
      ctx.shadowBlur = 0;
      ctx.shadowOffsetY = 0;

      // Área da foto
      ctx.fillStyle = "#f5f7fb";
      roundRect(ctx, 120, 140, 840, 520, 36);
      ctx.fill();

      // Foto (cover) com cantos arredondados
      drawImageCover(ctx, img, 120, 140, 840, 520, 36);

      // Selo PROMOÇÃO
      ctx.save();
      ctx.translate(140, 115);
      ctx.rotate(-0.12);
      ctx.fillStyle = "#FF3B30";
      roundRect(ctx, 0, 0, 330, 92, 46);
      ctx.fill();
      ctx.fillStyle = "#fff";
      ctx.font = "bold 48px Arial";
      ctx.fillText("PROMOÇÃO", 32, 60);
      ctx.restore();

      // Nome do produto
      ctx.fillStyle = "#111";
      ctx.font = "bold 70px Arial";
      let y = 725;
      y = wrapText(ctx, nome, 120, y, 840, 78, 2);

      // Gramas (badge)
      if (gramas.trim()){
        ctx.fillStyle = "#EAF2FF";
        roundRect(ctx, 120, y + 8, 260, 86, 43);
        ctx.fill();
        ctx.fillStyle = "#1B4DFF";
        ctx.font = "bold 44px Arial";
        ctx.fillText(gramas, 150, y + 66);
      }

      // Descrição
      ctx.fillStyle = "#444";
      ctx.font = "40px Arial";
      wrapText(ctx, descricao, 120, y + 120, 840, 48, 2);

      // Caixa do preço
      const priceText = preco ? ("R$ " + preco) : "R$ --";
      ctx.fillStyle = "#FFD400";
      roundRect(ctx, 120, 900, 840, 140, 40);
      ctx.fill();

      // Preço grande
      ctx.fillStyle = "#111";
      ctx.font = "bold 110px Arial";
      ctx.fillText(priceText, 160, 1004);

      // Rodapé pequeno
      ctx.fillStyle = "#1f2d3d";
      ctx.font = "32px Arial";
      ctx.fillText("Oferta do dia • Aproveite!", 120, 1065);

      // Mostrar resultado
      lastDataUrl = canvas.toDataURL("image/png");
      const imgOut = document.getElementById("resultado");
      imgOut.src = lastDataUrl;

      document.getElementById("baixarBtn").style.display = "block";
    };

    img.src = e.target.result;
  };

  reader.readAsDataURL(file);
}

function baixar(){
  if (!lastDataUrl) return;
  const a = document.createElement("a");
  a.href = lastDataUrl;
  a.download = "oferta.png";
  document.body.appendChild(a);
  a.click();
  a.remove();
}
</script>

</body>
</html>
