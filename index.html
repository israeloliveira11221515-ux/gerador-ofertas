<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Flyer de Ofertas (WhatsApp)</title>
<style>
  :root{
    --bg:#081a2e;
    --muted:#b8c7da;
    --text:#eaf2ff;
    --accent:#ff3b30;
    --accent2:#ffd400;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:Arial, Helvetica, sans-serif;
    background:linear-gradient(180deg,#061425,#0d3b66);
    color:var(--text);
    padding:18px;
  }
  .wrap{max-width:1100px;margin:0 auto;}
  h1{margin:6px 0 4px;font-size:22px}
  p{margin:0 0 14px;color:var(--muted);font-size:13px;line-height:1.4}
  .grid{display:grid; gap:14px; grid-template-columns: 1fr;}
  @media (min-width: 980px){ .grid{grid-template-columns: 430px 1fr;} }

  .panel{
    background:rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.12);
    border-radius:16px;
    overflow:hidden;
    box-shadow:0 18px 50px rgba(0,0,0,.35);
  }
  .hd{
    padding:12px 14px;
    background:rgba(0,0,0,.18);
    border-bottom:1px solid rgba(255,255,255,.10);
    display:flex; justify-content:space-between; align-items:center; gap:10px;
  }
  .hd b{font-size:14px}
  .pill{font-size:12px;color:#d7e6ff;background:rgba(255,212,0,.18);border:1px solid rgba(255,212,0,.35);padding:6px 10px;border-radius:999px}
  .bd{padding:12px 14px;background:rgba(10,24,40,.25)}
  label{display:block;font-size:12px;color:var(--muted);margin:10px 0 6px}
  input, select{
    width:100%; padding:11px 12px; border-radius:12px;
    border:1px solid rgba(255,255,255,.14);
    background:rgba(255,255,255,.06);
    color:var(--text); outline:none;
  }
  input::placeholder{color:rgba(234,242,255,.55)}
  .row{display:grid; gap:10px}
  .row.two{grid-template-columns:1fr 1fr}
  @media (max-width: 460px){ .row.two{grid-template-columns:1fr} }

  .btn{
    width:100%; border:0; border-radius:12px; padding:12px 14px;
    font-weight:700; cursor:pointer; color:white; margin-top:12px;
  }
  .btn.ok{background:linear-gradient(180deg,#ff5a52,#ff3b30)}
  .btn.blue{background:linear-gradient(180deg,#2d67ff,#1b4dff); display:none;}
  .small{font-size:12px;color:var(--muted);margin-top:10px;line-height:1.4}

  .products{display:flex; flex-direction:column; gap:10px; margin-top:10px}
  .prodItem{
    background:rgba(0,0,0,.18);
    border:1px solid rgba(255,255,255,.10);
    border-radius:14px;
    padding:10px;
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:8px;
  }
  .prodItem .full{grid-column:1 / -1}
  .prodItem button{
    grid-column:1 / -1;
    background:#ff3b30; color:white; border:0; border-radius:10px;
    padding:10px; font-weight:700; cursor:pointer;
  }

  .previewBox{padding:14px;background:rgba(0,0,0,.12)}
  #out{
    width:100%;
    border-radius:16px;
    border:1px solid rgba(255,255,255,.12);
    display:none;
    box-shadow:0 20px 60px rgba(0,0,0,.35);
  }
  .empty{
    text-align:center;
    padding:30px 12px;
    color:rgba(234,242,255,.75);
    border:1px dashed rgba(255,255,255,.16);
    border-radius:16px;
  }
  canvas{display:none}
</style>
</head>
<body>
<div class="wrap">
  <h1>Flyer de ofertas (Status 1080×1920)</h1>
  <p>Adicione produtos e gere um catálogo vertical pronto pro WhatsApp Status.</p>

  <div class="grid">
    <div class="panel">
      <div class="hd">
        <b>Configuração do flyer</b>
        <span class="pill">2 colunas • Status</span>
      </div>
      <div class="bd">
        <label>Logo (opcional)</label>
        <input type="file" id="logo" accept="image/*" />

        <label>Título</label>
        <input id="titulo" placeholder="Ex: SUPER OFERTAS" value="SUPER OFERTAS" />

        <label>Subtítulo (opcional)</label>
        <input id="subtitulo" placeholder="Ex: FINAL DE SEMANA" value="FINAL DE SEMANA" />

        <div class="row two">
          <div>
            <label>Nome da loja</label>
            <input id="loja" placeholder="Ex: Mercantil São Raimundo" />
          </div>
          <div>
            <label>WhatsApp</label>
            <input id="whats" placeholder="Ex: (88) 9 9999-9999" />
          </div>
        </div>

        <label>Adicionar produto</label>
        <div class="prodItem">
          <div class="full"><input type="file" id="pFoto" accept="image/*" /></div>
          <input id="pNome" placeholder="Nome do produto" />
          <input id="pUn" placeholder="Unidade (ex: 1kg / 1L / und)" />
          <input id="pPreco" placeholder="Preço (ex: 9,99)" />
          <input id="pObs" class="full" placeholder="Obs (opcional: -1kg, por cliente, etc)" />
          <button type="button" onclick="addProduto()">+ Adicionar na lista</button>
        </div>

        <div class="products" id="lista"></div>

        <button class="btn ok" onclick="gerarFlyer()">Gerar flyer (Status)</button>
        <button class="btn blue" id="baixarBtn" onclick="baixar()">Baixar PNG</button>

        <div class="small">Dica: 6 a 10 produtos fica perfeito no Status.</div>
      </div>
    </div>

    <div class="panel">
      <div class="hd">
        <b>Pré-visualização</b>
        <span class="pill">Pronta pra postar</span>
      </div>
      <div class="previewBox">
        <div class="empty" id="empty">Clique em <b>Gerar flyer</b> para ver a imagem aqui.</div>
        <img id="out" alt="Flyer pronto" />
      </div>
    </div>
  </div>

  <canvas id="c"></canvas>
</div>

<script>
  function roundRect(ctx, x, y, w, h, r){
    const min = Math.min(w,h);
    r = Math.min(r, min/2);
    ctx.beginPath();
    ctx.moveTo(x+r, y);
    ctx.arcTo(x+w, y, x+w, y+h, r);
    ctx.arcTo(x+w, y+h, x, y+h, r);
    ctx.arcTo(x, y+h, x, y, r);
    ctx.arcTo(x, y, x+w, y, r);
    ctx.closePath();
  }

  function drawLogoContain(ctx, img, x, y, w, h, r){
    const iw=img.width, ih=img.height;
    const s=Math.min(w/iw, h/ih);
    const nw=iw*s, nh=ih*s;
    const nx=x+(w-nw)/2, ny=y+(h-nh)/2;
    ctx.save();
    roundRect(ctx,x,y,w,h,r);
    ctx.clip();
    ctx.drawImage(img,nx,ny,nw,nh);
    ctx.restore();
  }

  function drawImageCover(ctx, img, x, y, w, h, r){
    const iw=img.width, ih=img.height;
    const ir=iw/ih, rr=w/h;
    let sx,sy,sw,sh;
    if(ir>rr){ sh=ih; sw=ih*rr; sx=(iw-sw)/2; sy=0; }
    else { sw=iw; sh=iw/rr; sx=0; sy=(ih-sh)/2; }
    ctx.save();
    roundRect(ctx,x,y,w,h,r);
    ctx.clip();
    ctx.drawImage(img,sx,sy,sw,sh,x,y,w,h);
    ctx.restore();
  }

  function loadFileAsImage(file){
    return new Promise((resolve,reject)=>{
      if(!file) return resolve(null);
      const r=new FileReader();
      r.onload=(e)=>{
        const img=new Image();
        img.onload=()=>resolve(img);
        img.onerror=reject;
        img.src=e.target.result;
      };
      r.onerror=reject;
      r.readAsDataURL(file);
    });
  }

  const produtos = [];
  let lastDataUrl = "";

  function renderLista(){
    const el = document.getElementById("lista");
    el.innerHTML = "";
    produtos.forEach((p, i)=>{
      const d = document.createElement("div");
      d.className = "prodItem";
      d.innerHTML = `
        <div class="full" style="color:#d7e6ff;font-weight:700">#${i+1} • ${p.nome} (R$ ${p.preco})</div>
        <div>Unidade: <b>${p.unidade || "-"}</b></div>
        <div>Obs: <b>${p.obs || "-"}</b></div>
        <button type="button" onclick="remover(${i})">Remover</button>
      `;
      el.appendChild(d);
    });
  }

  async function addProduto(){
    const file = document.getElementById("pFoto").files[0];
    const nome = (document.getElementById("pNome").value || "").trim();
    const unidade = (document.getElementById("pUn").value || "").trim();
    const preco = (document.getElementById("pPreco").value || "").trim();
    const obs = (document.getElementById("pObs").value || "").trim();

    if(!file || !nome || !preco){
      alert("Para adicionar: Foto + Nome + Preço (obrigatório).");
      return;
    }

    const img = await loadFileAsImage(file);
    produtos.push({img, nome, unidade, preco, obs});

    document.getElementById("pFoto").value = "";
    document.getElementById("pNome").value = "";
    document.getElementById("pUn").value = "";
    document.getElementById("pPreco").value = "";
    document.getElementById("pObs").value = "";

    renderLista();
  }

  function remover(i){
    produtos.splice(i,1);
    renderLista();
  }

  async function gerarFlyer(){
    if(produtos.length === 0){
      alert("Adicione pelo menos 1 produto.");
      return;
    }

    const titulo = (document.getElementById("titulo").value || "SUPER OFERTAS").trim();
    const subtitulo = (document.getElementById("subtitulo").value || "").trim();
    const loja = (document.getElementById("loja").value || "").trim();
    const whats = (document.getElementById("whats").value || "").trim();

    const logoFile = document.getElementById("logo").files[0];
    const logoImg = await loadFileAsImage(logoFile);

    const canvas = document.getElementById("c");
    const ctx = canvas.getContext("2d");

    const W = 1080;
    const H = 1920; // Status fixo
    canvas.width = W;
    canvas.height = H;

    // Fundo
    const bg = ctx.createLinearGradient(0,0,W,H);
    bg.addColorStop(0,"#0b1b2b");
    bg.addColorStop(1,"#0d3b66");
    ctx.fillStyle = bg;
    ctx.fillRect(0,0,W,H);

    // Header faixa
    ctx.fillStyle = "#ff3b30";
    roundRect(ctx, 60, 50, W-120, 190, 44);
    ctx.fill();

    // Título
    ctx.fillStyle = "#fff";
    ctx.font = "900 88px Arial";
    ctx.fillText(titulo.toUpperCase().slice(0,16), 110, 155);

    // Subtítulo
    if(subtitulo){
      ctx.fillStyle = "#fff";
      ctx.font = "800 46px Arial";
      ctx.fillText(subtitulo.toUpperCase().slice(0,20), 110, 215);
    }

    // Logo (direita)
    if(logoImg){
      ctx.fillStyle = "rgba(255,255,255,.22)";
      roundRect(ctx, W-320, 88, 200, 120, 28);
      ctx.fill();
      drawLogoContain(ctx, logoImg, W-320, 88, 200, 120, 28);
    }

    // Grade 2 colunas com cards maiores
    const topY = 270;
    const bottomY = H - 155;
    const areaH = bottomY - topY;

    const cols = 2;
    const gap = 28;
    const cardW = (W - 60*2 - gap) / cols;

    const rows = Math.ceil(produtos.length / cols);
    const cardH = Math.min(330, (areaH - gap*(rows-1)) / rows);

    let idx = 0;
    for(let r=0; r<rows; r++){
      for(let c=0; c<cols; c++){
        if(idx >= produtos.length) break;
        const p = produtos[idx++];

        const x = 60 + c*(cardW + gap);
        const y = topY + r*(cardH + gap);

        // card branco
        ctx.fillStyle = "rgba(255,255,255,.96)";
        roundRect(ctx, x, y, cardW, cardH, 26);
        ctx.fill();

        // foto
        const imgX = x + 18;
        const imgY = y + 18;
        const imgW = cardW - 36;
        const imgH = cardH * 0.62;
        ctx.fillStyle = "#f4f6fb";
        roundRect(ctx, imgX, imgY, imgW, imgH, 20);
        ctx.fill();
        drawImageCover(ctx, p.img, imgX, imgY, imgW, imgH, 20);

        // nome
        ctx.fillStyle = "#111";
        ctx.font = "800 36px Arial";
        ctx.fillText(p.nome.slice(0,22), x + 22, y + imgH + 78);

        // unidade/obs
        ctx.fillStyle = "#333";
        ctx.font = "30px Arial";
        const meta = [p.unidade, p.obs].filter(Boolean).join(" ");
        ctx.fillText(meta.slice(0,26), x + 22, y + imgH + 118);

        // preço (selo amarelo)
        ctx.fillStyle = "#ffd400";
        roundRect(ctx, x + 22, y + cardH - 82, cardW - 44, 62, 18);
        ctx.fill();

        ctx.fillStyle = "#111";
        ctx.font = "900 46px Arial";
        ctx.fillText("R$ " + p.preco, x + 44, y + cardH - 36);
      }
    }

    // Rodapé
    ctx.fillStyle = "rgba(0,0,0,.18)";
    roundRect(ctx, 60, H-125, W-120, 78, 28);
    ctx.fill();

    ctx.fillStyle = "#fff";
    ctx.font = "700 32px Arial";
    const footer = [loja, whats].filter(Boolean).join(" • ");
    ctx.fillText(footer || "Aproveite! Ofertas por tempo limitado.", 90, H-73);

    // Output
    lastDataUrl = canvas.toDataURL("image/png");
    const out = document.getElementById("out");
    out.src = lastDataUrl;
    out.style.display = "block";
    document.getElementById("empty").style.display = "none";
    document.getElementById("baixarBtn").style.display = "block";
  }

  function baixar(){
    if(!lastDataUrl) return;
    const a = document.createElement("a");
    a.href = lastDataUrl;
    a.download = "flyer-ofertas-status.png";
    document.body.appendChild(a);
    a.click();
    a.remove();
  }
</script>
</body>
</html>
